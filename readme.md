# Тестовое задание Infotecs
---
Локальный CI/CD пайплайн для сборки и тестирования open-source проекта на C/C++ (Nginx) внутри sandbox Docker-контейнера. Пайплайн поддерживает три режима сборки:
 - Release — релизная сборка с минимальным количеством отладочной информации и применением оптимизаций
 - Debug — отладочная сборка с включенной отладочной информацией
 - Coverage — сборка с инструментами gcov/lcov, выполнением тестов и генерацией отчёта о покрытии кода тестами.

## Структура проекта
- Dockerfile — рецепт сборки контейнера sandbox.
- Makefile — сценарии сборки и тестирования.
- history.log — лог сборок с параметрами и метриками покрытия кода.
- artifacts/ — директория для выходных артефактов (deb-пакеты, отчёты покрытия).
- src/nginx — исходный код Nginx.

## Использование 
```make sandbox``` - Перед выполнением сборок проверяется наличие контейнера sandbox-ci. Если он отсутствует, запускается его сборка.
```make build_release SRC_DIR=/путь/к/исходникам/``` - Создаёт оптимизированный deb-пакет без отладочной информации.
```make build_debug SRC_DIR=/путь/к/исходникам/``` - Создаёт deb-пакет с отладочной информацией.
```make build_coverage SRC_DIR=/путь/к/исходникам/``` - Выполняет сборку с инструментами покрытия, тестирует бинарь (nginx -V), генерирует HTML-отчёт покрытия кода и анализирует результаты. Если уровень покрытия увеличился, сборка останавливается с предупреждением.
```make clean``` - Удаляет сгенерированные файлы и артефакты

Пример:
```make build_release SRC_DIR=./src/nginx/```
## История сборок
Каждый запуск сборки фиксируется в history.log в формате:
```<номер_ревизии> <тип_сборки> <уровень_покрытия_тестами_в_строках>```
## Артефакты
Готовые deb-пакеты создаются в artifacts/ и именуются по шаблону:
```nginx_<номер_ревизии>-<тип_сборки>.deb```
Отчеты о покрытии создаются в ```artifacts/номер_ревизии/```